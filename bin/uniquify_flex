#!/bin/sh
#
# Rename necessary globals in lex output so that global name
# collisions do not occur between distinct scanners.  yyfoo becomes
# fn_foo, where the scanner is named fnscan or fnlex, and is defined
# in fnscan.flex.c or fnlex.flex.c.
#

NAME=`echo $1 | sed -e 's/scan$//' -e 's/lex$//'`

cat $1.flex.c \
  | sed -e "s/yylex/${NAME}_yylex/g"\
	-e "s/yylval/${NAME}_yylval/g"\
	-e "s/void yy_switch/static void yy_switch/g"\
	-e "s/void yy_load/static void yy_load/g"\
	-e "s/void yy_delete/static void yy_delete/g"\
	-e "s/void yy_init/static void yy_init/g"\
	-e "s/void yy_flush/static void yy_flush/g"\
	-e "s/void yyrestart/static void yyrestart/g"\
	-e "s/YY_BUFFER_STATE yy_create_/static YY_BUFFER_STATE yy_create_/g"\
	-e "s/YYSTYPE/${NAME}_YYSTYPE/g"\
	-e "s/yytext/${NAME}_yytext/g"\
	-e "s/static\ static/static/g"\
	-e "s/\#line/\/\/\#line/g"\
	-e "s/^FILE \*yyin = (FILE \*) 0, \*yyout = (FILE \*) 0;$/extern FILE *yyin, *yyout;/"\
> $1.c

rm $1.flex.c
